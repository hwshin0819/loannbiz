<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>중개사무소 지도</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBbgM7E_p4X7UZ_gnoSUe1fg71bU-kNSG0&callback=initMap" async defer></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
      /* 지도 크기 설정 */
      #map {
        height: 100%;
      }
      html, body {
        height: 100%;
        margin: 0;
      }
    </style>
  </head>
  <body>
    <h3>중개사무소 지도</h3>
    <div id="map"></div>
    <script>
      let map;
      
      // 지도 초기화
      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 37.5665, lng: 126.978 }, // 서울 중심
          zoom: 12,
        });

        // 구글 시트 API 로드
        gapi.load("client", initClient);
      }

      // 구글 시트 API 초기화
      function initClient() {
        gapi.client.init({
          apiKey: "AIzaSyBbgM7E_p4X7UZ_gnoSUe1fg71bU-kNSG0",
        }).then(() => {
          // 구글 시트 API 호출
          loadSheetData();
        });
      }

      // 구글 시트 데이터 불러오기
      function loadSheetData() {
        const sheetId = "1ZszZW_iI-F6Q3N2M7c_l6JZTrcEMUHLwfOizLVbs3sY";
        const range = "Sheet1!A2:G"; // 데이터가 있는 범위 (A열부터 G열까지)

        gapi.client.sheets.spreadsheets.values.get({
          spreadsheetId: sheetId,
          range: range,
        }).then((response) => {
          const rows = response.result.values;
          if (rows.length) {
            // 시트 데이터 처리
            rows.forEach((row) => {
              const name = row[0]; // 중개사무소명 (A열)
              const address = row[1]; // 주소 (B열)
              const phone = row[2] || "전화번호 미제공"; // 전화번호 (C열)
              const contact = row[3]; // 담당자 (D열)
              const ranking = row[4]; // 랭킹 (E열)
              const lat = parseFloat(row[5]); // X좌표 (F열)
              const lng = parseFloat(row[6]); // Y좌표 (G열)

              // 마커 생성
              const marker = new google.maps.Marker({
                position: { lat, lng },
                map: map,
                title: name,
              });

              // 정보창 내용 구성
              const infoContent = `
                <h3>${name}</h3>
                <p><strong>주소:</strong> ${address}</p>
                <p><strong>전화번호:</strong> ${phone}</p>
                <p><strong>담당자:</strong> ${contact}</p>
                <p><strong>랭킹:</strong> ${ranking}</p>
              `;

              // 정보창을 마커에 연결
              const infoWindow = new google.maps.InfoWindow({
                content: infoContent,
              });

              // 마커 클릭 시 정보창 열기
              marker.addListener("click", () => {
                infoWindow.open(map, marker);
              });
            });
          } else {
            console.log("데이터가 없습니다.");
          }
        });
      }
    </script>
  </body>
</html>
